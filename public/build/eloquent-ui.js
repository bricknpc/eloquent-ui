(function(){const a="eloquent-ui";class c{constructor(t){var e;if(!t)throw new Error("Currency component element is required");if(this.element=t,this.name=t.dataset[`${this.camelCase(a)}Name`],!this.name)throw new Error("Currency component must have a data-eloquent-ui-name attribute");if(this.wholeInput=t.querySelector(`#${this.name}-whole`),this.centsInput=t.querySelector(`#${this.name}-cents`),this.currencyInput=document.getElementById(`${this.name}-currency`),!this.wholeInput||!this.centsInput)throw new Error(`Currency inputs not found for ${this.name}`);this.config={focusSwitch:t.dataset[`${this.camelCase(a)}FocusSwitch`]!=="false",required:t.dataset[`${this.camelCase(a)}Required`]==="true",min:this.parseNumber(t.dataset[`${this.camelCase(a)}Min`]),max:this.parseNumber(t.dataset[`${this.camelCase(a)}Max`])},this.currencyButton=t.querySelector(`[data-${a}-currency-select]`),this.currencyDropdown=t.querySelector(".dropdown-menu"),this.currencyAnnouncement=((e=t.parentElement)==null?void 0:e.querySelector(`[data-${a}-currency-announcement]`))||document.querySelector(`[data-${a}-currency-announcement][data-${a}-name="${this.name}"]`),this.init()}camelCase(t){return t.replace(/-([a-z])/g,e=>e[1].toUpperCase())}parseNumber(t){if(t==null||t==="")return null;const e=parseInt(t,10);return isNaN(e)?null:e}init(){this.padCents(),this.centsInput.addEventListener("input",this.handleCentsInput.bind(this)),this.centsInput.addEventListener("blur",this.padCents.bind(this)),this.config.focusSwitch&&this.wholeInput.addEventListener("keypress",this.handleDecimalKey.bind(this)),this.wholeInput.addEventListener("paste",this.handlePaste.bind(this)),this.centsInput.addEventListener("paste",this.handlePaste.bind(this)),this.currencyButton&&this.currencyDropdown&&this.initCurrencyDropdown(),this.wholeInput.addEventListener("change",this.validate.bind(this)),this.centsInput.addEventListener("change",this.validate.bind(this))}padCents(){const t=this.centsInput.value;if(t!==""){const e=parseInt(t,10);isNaN(e)||(this.centsInput.value=Math.abs(e).toString().padStart(2,"0"))}}handleCentsInput(t){let e=parseInt(t.target.value)||0;const s=parseInt(this.wholeInput.value)||0;if(e>99){const n=Math.floor(e/100),i=e%100;let r=s+n;this.config.max!==null&&r>this.config.max?(this.wholeInput.value=this.config.max,this.centsInput.value="99"):(this.wholeInput.value=r,this.centsInput.value=i.toString().padStart(2,"0"))}else if(e<0){const n=Math.ceil(Math.abs(e)/100),i=100-Math.abs(e)%100;let r=s-n;this.config.min!==null&&r<this.config.min?(this.wholeInput.value=this.config.min,this.centsInput.value="00"):(this.wholeInput.value=r,this.centsInput.value=(i===100?0:i).toString().padStart(2,"0"))}else this.centsInput.value=e.toString().padStart(2,"0")}handleDecimalKey(t){(t.key===","||t.key===".")&&(t.preventDefault(),this.centsInput.focus(),this.centsInput.select())}parseAmount(t){t=t.trim();const e=t.lastIndexOf("."),s=t.lastIndexOf(",");(e>s?".":",")==="."?t=t.replace(/[,_\s]/g,""):t=t.replace(/[._\s]/g,"").replace(",",".");const i=parseFloat(t);if(isNaN(i))return null;const r=Math.floor(i),u=Math.round((i-r)*100);return{whole:r,cents:u}}handlePaste(t){t.preventDefault();const e=(t.clipboardData||window.clipboardData).getData("text"),s=this.parseAmount(e);if(s!==null){let n=s.whole,i=s.cents;this.config.min!==null&&n<this.config.min&&(n=this.config.min,i=0),this.config.max!==null&&n>this.config.max&&(n=this.config.max,i=99),this.wholeInput.value=n,this.centsInput.value=i.toString().padStart(2,"0"),this.validate()}}initCurrencyDropdown(){const t=this.currencyDropdown.querySelectorAll(".dropdown-item");this.currencyButton.dataset[`${this.camelCase(a)}CurrencySymbol`],t.forEach(e=>{e.addEventListener("click",s=>{s.preventDefault();const n=e.dataset[`${this.camelCase(a)}Value`],i=e.textContent.trim();if(this.currencyButton.textContent=i,this.currencyInput?(this.currencyInput.value=n,this.currencyInput.dispatchEvent(new Event("change",{bubbles:!0}))):console.warn(`Hidden currency input #${this.name}-currency not found`),t.forEach(r=>r.removeAttribute("aria-current")),e.setAttribute("aria-current","true"),this.announceCurrencyChange(n,i),typeof bootstrap<"u"&&bootstrap.Dropdown){const r=bootstrap.Dropdown.getInstance(this.currencyButton);r&&r.hide()}})})}announceCurrencyChange(t,e){if(!this.currencyAnnouncement)return;const n=(this.currencyAnnouncement.dataset[`${this.camelCase(a)}CurrencyAnnouncementMessage`]||"Currency of :attribute has been changed to :key (:value)").replace(":attribute",this.name).replace(":key",t).replace(":value",e);this.currencyAnnouncement.textContent=n,setTimeout(()=>{this.currencyAnnouncement.textContent=""},1e3)}validate(){const t=parseInt(this.wholeInput.value)||0,e=parseInt(this.centsInput.value)||0,s=t*100+e;let n=!0;if(this.config.min!==null){const i=this.config.min*100;s<i&&(n=!1,this.wholeInput.value=this.config.min,this.centsInput.value="00")}if(this.config.max!==null){const i=this.config.max*100;s>i&&(n=!1,this.wholeInput.value=this.config.max,this.centsInput.value="99")}return n}getValue(){return{whole:parseInt(this.wholeInput.value)||0,cents:parseInt(this.centsInput.value)||0,currency:this.currencyInput?this.currencyInput.value:null,amount:parseFloat(`${this.wholeInput.value||0}.${this.centsInput.value||0}`),amountInCents:(parseInt(this.wholeInput.value)||0)*100+(parseInt(this.centsInput.value)||0)}}setValue(t,e,s=null){if(this.wholeInput.value=t,this.centsInput.value=e.toString().padStart(2,"0"),s!==null&&this.currencyInput&&(this.currencyInput.value=s,this.currencyButton)){const n=this.currencyDropdown.querySelector(`[data-${a}-value="${s}"]`);n&&(this.currencyButton.textContent=n.textContent.trim())}this.validate()}destroy(){const t={centsInput:this.handleCentsInput.bind(this),centsBlur:this.padCents.bind(this),wholeKeypress:this.handleDecimalKey.bind(this),wholePaste:this.handlePaste.bind(this),centsPaste:this.handlePaste.bind(this),wholeChange:this.validate.bind(this),centsChange:this.validate.bind(this)};this.centsInput.removeEventListener("input",t.centsInput),this.centsInput.removeEventListener("blur",t.centsBlur),this.wholeInput.removeEventListener("keypress",t.wholeKeypress),this.wholeInput.removeEventListener("paste",t.wholePaste),this.centsInput.removeEventListener("paste",t.centsPaste),this.wholeInput.removeEventListener("change",t.wholeChange),this.centsInput.removeEventListener("change",t.centsChange)}static init(){const t=`[data-${a}-input="currency"]`,e=document.querySelectorAll(t),s=[];return e.forEach(n=>{try{s.push(new c(n))}catch(i){console.error("Failed to initialize currency component:",i,n)}}),s}}window.EloquentUI||(window.EloquentUI={}),window.EloquentUI.Currency=c})();
